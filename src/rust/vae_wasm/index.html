<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wasm VAE Explorer</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; margin-top: 50px; }
        canvas { width: 280px; height: 280px; image-rendering: pixelated; border: 1px solid #ccc; margin-bottom: 20px;}
        .sliders { display: flex; gap: 20px; }
        .slider-group { display: flex; flex-direction: column; align-items: center; }
    </style>
</head>
<body>

    <h2>Rust + Wasm VAE Latent Space</h2>
    <canvas id="vae-canvas" width="28" height="28"></canvas>

    <div class="sliders">
        <div class="slider-group">
            <label>z1 (X-axis)</label>
            <input type="range" id="z1" min="-3" max="3" step="0.1" value="0">
        </div>
        <div class="slider-group">
            <label>z2 (Y-axis)</label>
            <input type="range" id="z2" min="-3" max="3" step="0.1" value="0">
        </div>
    </div>

    <script type="module">
        // Import the WASM module
        import init, { VaeDecoder } from './pkg/vae_wasm.js';

        async function run() {
            await init(); // Initialize WebAssembly
            
            const decoder = new VaeDecoder();
            const canvas = document.getElementById('vae-canvas');
            const ctx = canvas.getContext('2d');
            
            const z1Input = document.getElementById('z1');
            const z2Input = document.getElementById('z2');

            function updateImage() {
                const z1 = parseFloat(z1Input.value);
                const z2 = parseFloat(z2Input.value);

                // 1. Call Rust to do the heavy math
                const pixels = decoder.generate(z1, z2);

                // 2. Draw the returned array to the HTML Canvas
                const imageData = ctx.createImageData(28, 28);
                for (let i = 0; i < 784; i++) {
                    const val = pixels[i];
                    const idx = i * 4;
                    imageData.data[idx] = val;     // R
                    imageData.data[idx+1] = val;   // G
                    imageData.data[idx+2] = val;   // B
                    imageData.data[idx+3] = 255;   // Alpha
                }
                ctx.putImageData(imageData, 0, 0);
            }

            // Listen for slider movements
            z1Input.addEventListener('input', updateImage);
            z2Input.addEventListener('input', updateImage);

            // Initial draw
            updateImage();
        }

        run();
    </script>
</body>
</html>